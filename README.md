# Web-IPAM System

**Web-based IP Address Management System** - Веб-система для управления IP-адресным пространством оператора связи.

## О проекте

Web-IPAM (IP Address Management) — это полнофункциональное веб-приложение для автоматизации учета и управления IP-инфраструктурой. Система разработана для замены ручного ведения учета в Excel-таблицах и предотвращения конфликтов IP-адресов в сетях провайдеров и корпоративных сетях.

### Решаемые проблемы

* **Хаотичный учет IP-адресов** в Excel-таблицах
* **IP-конфликты** из-за ручного управления
* **Отсутствие централизованной информации** о сетевой инфраструктуре
* **Сложность поиска** информации об абонентах и устройствах
* **Отсутствие контроля доступа** к сетевым данным
* **Нет истории изменений** - кто и когда менял конфигурацию

## Реализованный функционал

#### Система аутентификации и авторизации

* **Безопасный вход** с хэшированием паролей
* **Ролевая модель доступа** (Администратор, Инженер, Оператор)
* **Защита от brute-force атак** с автоматической блокировкой
* **Система блокировок** IP и пользователей
* **Защита сессий** с таймаутом
* **Подготовленные SQL-запросы** - защита от инъекций

#### Дашборд системы

* **Визуальная статистика** в реальном времени
* **Ключевые метрики**: клиенты, активные IP, свободные IP, подсети
* **Разделение по типам IP**: белые/серые адреса
* **Быстрый доступ** ко всем модулям системы

#### Модуль управления IP-адресами

* **Полный CRUD** - создание, чтение, обновление, удаление
* **Расширенная фильтрация** по типу, статусу, подсети
* **Умный поиск** по IP, MAC-адресу, клиенту, описанию
* **Визуальные индикаторы** статусов и типов IP
* **Статистика** по каждому разделу
* **Валидация данных** - проверка принадлежности IP к подсети

#### Расширенная система аудита и безопасности

* **Полное логирование всех действий** в системе
* **Журнал аудита** с фильтрацией и поиском
* **Отслеживание входа/выхода** пользователей
* **Мониторинг неудачных попыток входа**
* **Система блокировок** IP-адресов при подозрительной активности
* **Статистика безопасности** в реальном времени
* **Подозрительная активность** - автоматическое обнаружение атак

## Что отслеживается в системе аудита

### Полный аудит всех действий:

* **Вход/выход пользователей** - успешные и неудачные попытки
* **Создание IP-адресов** - кто, когда и какие данные ввел
* **Изменение IP-адресов** - какие поля изменились, старые и новые значения
* **Удаление IP-адресов** - полная информация об удаленной записи
* **Блокировки безопасности** - автоматические и ручные блокировки IP
* **Поисковые запросы** - что искали пользователи

### Система безопасности:

* **Автоматическая блокировка IP** после 10 неудачных попыток входа за час
* **Блокировка пользователей** после 5 неудачных попыток входа
* **Мониторинг подозрительной активности** в реальном времени
* **Визуализация атак** на систему аутентификации

## Технологический стек

### Backend

* **PHP 7.4+** - серверный язык с ООП подходом
* **MySQL 5.7+** - реляционная база данных
* **Apache** - веб-сервер
* **Сессии PHP** - управление аутентификацией

### Frontend

* **HTML5** - семантическая разметка
* **CSS3** - современные стили с Flexbox/Grid
* **JavaScript (ES6+)** - клиентская логика
* **Bootstrap 5** - адаптивный UI-фреймворк
* **Responsive Design** - мобильная адаптация

### Безопасность

* **Password hashing** - `password_hash()`/`password_verify()`
* **Prepared statements** - защита от SQL-инъекций
* **Input validation** - валидация всех входных данных
* **Session security** - регенерация ID, таймауты
* **XSS protection** - `htmlspecialchars()` на выводе
* **Ролевой доступ** - разделение прав по ролям
* **Brute-force protection** - автоматическая блокировка атак
* **IP blocking** - защита от подозрительной активности

## Архитектура базы данных

```
users (Пользователи системы)
├── id, login, password_hash, role, full_name, created_at
├── last_login, failed_login_attempts, account_locked_until

clients (Клиенты-абоненты)  
├── id, contract_number, full_name, address, phone

subnets (Подсети)
├── id, network_address, cidr_mask, gateway, description

devices (Сетевые устройства)
├── id, mac_address, model, serial_number, client_id

ip_addresses (IP-адреса)
├── id, ip_address, subnet_id, device_id, type, status, 
│   description, created_by, created_at, updated_at

system_audit_log (Общий аудит системы)
├── id, user_id, action_type, module, record_id, description,
│   ip_address, user_agent, old_values, new_values, created_at

security_blocks (Блокировки безопасности)
├── id, ip_address, block_type, attempts, first_attempt,
│   last_attempt, blocked_until, reason
```

**Связи:** Внешние ключи обеспечивают целостность данных между таблицами.

## Ролевая модель доступа

### Администратор

* **Полный доступ** ко всем функциям системы
* **Управление IP-адресами** - создание, редактирование, удаление
* **Просмотр журнала аудита** - история всех действий в системе
* **Мониторинг безопасности** - просмотр блокировок и атак
* **Доступ ко всем модулям**

### Сетевой инженер

* **Управление IP-адресами** - создание, редактирование
* **Привязка белых IP** к клиентам
* **Настройка оборудования** на основе данных системы
* **Просмотр всей информации** о сети и клиентах
* **Доступ к базовым отчетам** безопасности

### Оператор

* **Просмотр информации** - клиенты, устройства, IP-адреса
* **Ограниченное редактирование** IP-адресов
* **Поиск информации** для техподдержки
* **Нет доступа к удалению**
* **Нет доступа к журналу аудита**

## Структура проекта

```
web-ipam/
├── index.php                 # Главная страница (Дашборд)
├── login.php                 # Страница авторизации
├── logout.php                # Выход из системы
├── README.md                 # Документация
├── .gitignore                # Git исключения
│
├── includes/                 # PHP модули системы
│   ├── auth.php              # Аутентификация и авторизация
│   ├── db_connect.php        # Безопасное подключение к БД (ООП)
│   ├── audit_system.php      # Расширенная система аудита и безопасности
│   ├── header.php            # Навигация и шапка сайта
│   └── footer.php            # Подвал сайта
│
├── pages/                    # Функциональные модули
│   ├── ip-addresses/         # ПОЛНОСТЬЮ РЕАЛИЗОВАНО
│   │   ├── list.php            # Список IP-адресов с фильтрами
│   │   ├── add.php             # Добавление IP-адреса
│   │   ├── edit.php            # Редактирование IP-адреса
│   │   └── delete.php          # Удаление IP-адреса
│   │
│   ├── audit/                # ПОЛНОСТЬЮ РЕАЛИЗОВАНО
│   │   └── list.php            # Журнал аудита системы
│   │
│   ├── clients/              # В РАЗРАБОТКЕ
│   │   ├── list.php            # Список клиентов
│   │   └── edit.php            # Редактирование клиента
│   │
│   ├── devices/              # В РАЗРАБОТКЕ
│   │   ├── list.php            # Список устройств
│   │   └── edit.php            # Редактирование устройства
│   │
│   ├── subnets/              # В РАЗРАБОТКЕ
│   │   ├── list.php            # Список подсетей
│   │   └── edit.php            # Редактирование подсети
│   │
│   └── users/                # В РАЗРАБОТКЕ
│       ├── list.php            # Список пользователей
│       └── edit.php            # Редактирование пользователя
│
├── assets/                   # Статические ресурсы
│   ├── css/
│   │   └── style.css           # Основные стили
│   ├── js/
│   │   ├── main.js            # Основные скрипты
│   │   └── ip-form.js         # Валидация форм IP-адресов
│   └── img/                   # Изображения и иконки
│
└── sql/                      # База данных
    └── init.sql              # Инициализация БД (версия 5.0)
```

## Установка и запуск

### Предварительные требования

* **WAMP/MAMP/LAMP сервер** (рекомендуется WAMP для Windows)
* **PHP 7.4 или выше** с расширением MySQLi
* **MySQL 5.7 или выше** (поддерживается JSON для системы аудита)
* **Веб-браузер** с поддержкой ES6+

### ⚠️ Важные замечания перед установкой

* **Имя базы данных должно быть точно `web_ipam`** (с нижним подчеркиванием)
* **Пароли по умолчанию: `admin123`** для всех тестовых пользователей
* **Система требует MySQL 5.7+** для поддержки JSON полей в аудите
* **Часовой пояс настроен на Москву (UTC+3)** для корректной работы блокировок

### Пошаговая установка

1. **Клонирование репозитория**

```bash
git clone https://github.com/feronski-bkpk/web-ipam
cd web-ipam
```

2. **Настройка базы данных**
* Откройте phpMyAdmin (`http://localhost/phpmyadmin`)
* Нажмите "Создать базу данных" в левом меню
* Введите имя: `web_ipam` (обязательно с нижним подчеркиванием)
* Выберите кодировку: `utf8mb4_unicode_ci`
* Нажмите "Создать"
* Выберите созданную базу `web_ipam`
* Перейдите на вкладку "Импорт"
* Нажмите "Выбрать файл" и выберите `sql/init.sql`
* Нажмите "Вперед" (Execute)
3. **Размещение проекта**
* Скопируйте файлы в корневую папку веб-сервера
* Для WAMP: `C:\wamp64\www\web-ipam\`
* Убедитесь, что WAMP сервер запущен (зеленая иконка)
4. **Доступ к приложению**
* Откройте: `http://localhost/web-ipam`
* Используйте тестовые учетные данные:

### Тестовые пользователи

| Роль            | Логин      | Пароль     | Доступ                               |
| --------------- | ---------- | ---------- | ------------------------------------ |
| Администратор   | `admin`    | `admin123` | Полный доступ + аудит + безопасность |
| Сетевой инженер | `engineer` | `admin123` | Создание и редактирование IP         |
| Оператор        | `operator` | `admin123` | Просмотр и базовые операции          |

### Если возникают проблемы с входом

Если при правильном логине/пароле система пишет "Неверный логин или пароль":

1. **Проверьте имя базы данных** - должно быть `web_ipam`, а не `web-ipam`
2. **Убедитесь что WAMP сервер запущен** - иконка должна быть зеленой
3. **Проверьте импорт SQL** - все таблицы должны создаться без ошибок
4. **Проверьте пароли** - используйте `check_installation.php` для диагностики
5. **Проверьте блокировки** - возможно IP или пользователь заблокирован

### Структура базы данных после установки

После успешного импорта `init.sql` в базе должны быть созданы:

* `users` - пользователи системы (3 тестовых пользователя)
* `clients` - клиенты-абоненты (3 тестовых клиента)
* `subnets` - подсети (4 тестовых подсети)
* `devices` - сетевые устройства (3 тестовых устройства)
* `ip_addresses` - IP-адреса (7 тестовых записей)
* `system_audit_log` - система аудита (пустая, готова к работе)
* `security_blocks` - блокировки безопасности (пустая, готова к работе)

## Использование системы

### Быстрый старт

1. **Войдите в систему** с учетными данными выше
2. **Изучите дашборд** - основные метрики системы
3. **Перейдите в "IP-адреса"** - основной рабочий модуль
4. **Используйте фильтры** для поиска нужной информации
5. **Проверьте журнал аудита** - просмотр истории действий
6. **Мониторьте безопасность** - просмотр блокировок и атак

### Ключевые сценарии использования

#### Поиск информации об абоненте

1. Откройте раздел "IP-адреса"
2. Используйте поиск по ФИО клиента
3. Найдите все связанные IP и устройства

#### Добавление нового IP-адреса

1. Нажмите "Добавить IP-адрес"
2. Заполните форму с валидацией
3. Система проверит принадлежность к подсети
4. **Автоматически создаст запись в аудите**

#### Редактирование IP-адреса

1. Найдите нужный IP в списке
2. Нажмите кнопку редактирования
3. Внесите изменения
4. **Система запишет все изменения в аудит**

#### Мониторинг безопасности

1. Перейдите в "Журнал аудита"
2. Просмотрите статистику входов/выходов
3. Проверьте подозрительную активность
4. Просмотрите активные блокировки

#### Удаление IP-адреса (только админ)

1. Найдите IP для удаления
2. Нажмите кнопку удаления
3. Подтвердите действие
4. **Система сохранит данные в аудите перед удалением**

### Система безопасности в действии

#### При неудачных попытках входа:

* **1-4 попытки** - предупреждение в логах
* **5-я попытка** - блокировка пользователя на 30 минут
* **10 попыток с одного IP** - блокировка IP на 60 минут
* **Автоматическая разблокировка** по истечении времени

#### Мониторинг в реальном времени:

* **Статистика успешных/неудачных входов**
* **Топ подозрительных IP-адресов**
* **Визуализация атак** на систему
* **Автоматические оповещения** о подозрительной активности

## Текущий статус проекта

### Завершено ✅

* [x] Проектирование базы данных
* [x] Система аутентификации и ролей
* [x] Главный дашборд с метриками
* [x] Модуль IP-адресов (полный CRUD)
* [x] **Расширенная система аудита всех действий**
* [x] **Система безопасности с защитой от brute-force**
* [x] **Журнал аудита с мониторингом безопасности**
* [x] **Автоматическая блокировка IP и пользователей**
* [x] Расширенный поиск и фильтрация
* [x] Валидация данных и бизнес-логика
* [x] Адаптивный дизайн

### В процессе 🔄

* [ ] Модуль управления клиентами
* [ ] Модуль управления устройствами
* [ ] Модуль управления подсетями
* [ ] Модуль управления пользователями
* [ ] Расширенная отчетность

### Планируется 📋

* [ ] Глобальный поиск по системе
* [ ] API для интеграции с другими системами
* [ ] Уведомления и оповещения
* [ ] Резервное копирование данных
* [ ] Графики и аналитика использования IP
* [ ] Массовые операции с IP-адресами
* [ ] Экспорт данных в CSV/Excel
* [ ] Мобильное приложение

## Участие в разработке

Мы приветствуем contributions! Чтобы внести свой вклад:

1. Форкните репозиторий
2. Создайте feature branch (`git checkout -b feature/AmazingFeature`)
3. Закоммитьте изменения (`git commit -m 'Add some AmazingFeature'`)
4. Запушьте branch (`git push origin feature/AmazingFeature`)
5. Откройте Pull Request

## Особенности реализации

### Безопасность

* Все пароли хэшируются с помощью `password_hash()`
* SQL-инъекции предотвращаются подготовленными запросами
* XSS атаки блокируются экранированием вывода
* Ролевая модель ограничивает доступ к функциям
* **Защита от brute-force атак** с автоматической блокировкой
* **Мониторинг подозрительной активности** в реальном времени

### Аудит и мониторинг

* **Все действия в системе логируются** в таблицу `system_audit_log`
* Сохраняются старые и новые значения в JSON формате
* **Отслеживание входа/выхода** и неудачных попыток
* **Статистика безопасности** с визуализацией атак
* **Автоматическое обнаружение** подозрительной активности

### Бизнес-логика

* Проверка принадлежности IP к подсети
* Валидация согласованности статусов и устройств
* Предотвращение дублирования IP в подсетях
* Ограничение: одно устройство - один IP
* **Автоматическая блокировка** при превышении лимитов
* **Умное восстановление** после блокировок

### Пользовательский опыт

* Адаптивный дизайн для мобильных устройств
* Быстрые фильтры для частых операций
* Умная валидация форм в реальном времени
* Визуальные индикаторы статусов и безопасности
* **Понятные сообщения** о блокировках и ограничениях


