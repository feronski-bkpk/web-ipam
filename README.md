# Web-IPAM System

**Web-based IP Address Management System** - Веб-система для управления IP-адресным пространством оператора связи.

## О проекте

Web-IPAM (IP Address Management) — это веб-приложение для учета и управления IP-адресами в сетях провайдеров и корпоративных сетях. Система позволяет централизованно вести учет IP-инфраструктуры.

## Установка и настройка

### Предварительные требования

* **Веб-сервер**: Apache 2.4+ 
* **PHP**: 7.4 или выше с расширениями:
  * mysqli
  * session
  * json
* **База данных**: MySQL 5.7 или выше
* **Браузер**: Современный браузер

### Шаг 1: Настройка базы данных

1. **Создайте базу данных**:
   
   ```sql
   CREATE DATABASE web_ipam CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
   ```

2. **Импортируйте структуру** из файла `sql/init.sql`

### Шаг 2: Настройка подключения к БД

Отредактируйте файл `includes/db_connect.php`:

```php
// includes/db_connect.php
$servername = "localhost";    // Адрес сервера БД
$username = "root";           // Имя пользователя MySQL
$password = "";               // Пароль пользователя MySQL  
$dbname = "web_ipam";         // Имя базы данных
```

### Шаг 3: Размещение проекта

Разместите файлы проекта в директории веб-сервера:

- **WAMP**: `C:\wamp64\www\web-ipam\`
- **LAMP**: `/var/www/html/web-ipam/`
- **MAMP**: `/Applications/MAMP/htdocs/web-ipam/`

### Шаг 4: Проверка установки

1. Запустите веб-сервер
2. Откройте в браузере: `http://localhost/web-ipam/`
3. Должна открыться страница входа

## Тестовые пользователи

После установки используйте эти учетные записи:

| Роль          | Логин      | Пароль     | Описание                     |
| ------------- | ---------- | ---------- | ---------------------------- |
| Администратор | `admin`    | `admin123` | Полный доступ                |
| Инженер       | `engineer` | `admin123` | Управление IP и устройствами |
| Оператор      | `operator` | `admin123` | Просмотр информации          |

## Детальная структура проекта

```
web-ipam/
├── index.php                    # Главная страница с дашбордом
├── login.php                    # Страница аутентификации
├── logout.php                   # Выход из системы с логированием
├── README.md                    # Документация проекта
│
├── includes/                    # Системные модули PHP
│   ├── auth.php                 # Аутентификация, авторизация, проверка ролей
│   ├── db_connect.php           # Подключение к MySQL, класс Database
│   ├── audit_system.php         # Расширенная система аудита и безопасности
│   ├── audit.php                # Аудит действий с IP-адресами
│   ├── config.php               # Конфигурационные константы системы
│   ├── csrf.php                 # CSRF защита, генерация и валидация токенов
│   ├── header.php               # Навигация, шапка сайта, поисковая форма
│   ├── pagination.php           # Класс Pagination для постраничной навигации
│   └── validation.php           # Валидация и санитизация входных данных
│
├── pages/                       # Функциональные модули системы
│   │
│   ├── ip-addresses/            # Управление IP-адресами
│   │   ├── list.php             # Список IP с фильтрацией и поиском
│   │   ├── add.php              # Добавление нового IP-адреса
│   │   ├── edit.php             # Редактирование существующего IP
│   │   ├── delete.php           # Удаление IP-адреса с подтверждением
│   │   └── bulk_operations.php  # Массовые операции с IP-адресами
│   │
│   ├── clients/                 # Управление клиентами-абонентами
│   │   ├── list.php             # Список клиентов с поиском
│   │   ├── add.php              # Добавление нового клиента
│   │   ├── edit.php             # Редактирование данных клиента
│   │   └── delete.php           # Удаление клиента (только если нет устройств)
│   │
│   ├── devices/                 # Управление сетевыми устройствами
│   │   ├── list.php             # Список устройств с фильтрацией
│   │   ├── add.php              # Добавление устройства с валидацией MAC
│   │   ├── edit.php             # Редактирование устройства
│   │   └── delete.php           # Удаление устройства (только если нет IP)
│   │
│   ├── subnets/                 # Управление подсетями
│   │   ├── list.php             # Список подсетей с пагинацией
│   │   ├── add.php              # Добавление подсети с расчетом диапазона
│   │   ├── edit.php             # Редактирование подсети (шлюз, описание)
│   │   ├── delete.php           # Удаление подсети с подтверждением
│   │   ├── view.php             # Детальный просмотр подсети с IP-адресами
│   │   └── calculate_range.php  # API для расчета диапазона подсети (AJAX)
│   │
│   ├── users/                   # Управление пользователями системы
│   │   ├── list.php             # Список пользователей с ролями
│   │   ├── add.php              # Добавление нового пользователя
│   │   ├── edit.php             # Редактирование пользователя
│   │   └── delete.php           # Удаление пользователя
│   │
│   ├── audit/                   # Система аудита и безопасности
│   │   ├── list.php             # Журнал аудита с фильтрацией
│   │   └── export.php           # Экспорт отчетов в CSV формате
│   │
│   └── search/                  # Поиск по системе
│       └── global.php           # Глобальный поиск по всем модулям
│
├── assets/                      # Статические ресурсы
│   ├── css/
│   │   └── style.css            # Основные стили Bootstrap + кастомные
│   │
│   ├── js/                      # JavaScript файлы
│   │   ├── main.js              # Основные скрипты, обновление времени
│   │   └── ip-form.js           # Динамическая валидация форм IP-адресов
│   │
│   └── img/                     # Изображения (пока пустая)
│
└── sql/                         # База данных
    └── init.sql                 # Инициализация БД (версия 5.0) - таблицы и тестовые данные
```

## Описание ключевых файлов

### Системные файлы (корень)

- **`index.php`** - Главный дашборд системы со статистикой, быстрым доступом и последними действиями
- **`login.php`** - Страница входа с защитой от brute-force атак и блокировками
- **`logout.php`** - Выход из системы с очисткой сессии и логированием

### Модули includes/

- **`auth.php`** - Управление аутентификацией, проверка ролей, CSRF защита
- **`db_connect.php`** - Класс Database для безопасного подключения к MySQL
- **`audit_system.php`** - Основной класс аудита с логированием действий и безопасностью
- **`audit.php`** - Специализированные функции аудита для IP-адресов
- **`pagination.php`** - Класс для реализации постраничной навигации
- **`validation.php`** - Функции валидации IP, MAC-адресов, email

### Модуль IP-адресов

- **`list.php`** - Таблица с фильтрами по типу, статусу, подсети
- **`add.php`** - Форма с валидацией принадлежности IP к подсети
- **`edit.php`** - Редактирование с проверкой бизнес-логики
- **`bulk_operations.php`** - Массовое изменение статусов IP

### Модуль подсетей

- **`add.php`** - Создание подсети с автоматическим расчетом диапазона
- **`view.php`** - Детальный просмотр всех IP в подсети
- **`calculate_range.php`** - API для AJAX расчета сетевого диапазона

### Система аудита

- **`list.php`** - Журнал всех действий с фильтрацией по модулям и действиям
- **`export.php`** - Экспорт логов в CSV для анализа

## Архитектура базы данных

Основные таблицы из `sql/init.sql`:

- **`users`** - Пользователи системы (логин, хэш пароля, роль, блокировки)
- **`clients`** - Клиенты-абоненты (договор, ФИО, адрес, телефон)
- **`subnets`** - Подсети (адрес сети, маска, шлюз, описание)
- **`devices`** - Устройства (MAC-адрес, модель, серийный номер)
- **`ip_addresses`** - IP-адреса (адрес, тип, статус, привязки)
- **`system_audit_log`** - Журнал аудита (действия, пользователи, IP)
- **`security_blocks`** - Блокировки безопасности (IP, попытки входа)

## Ролевая модель доступа

### Администратор

- Полный доступ ко всем модулям
- Управление пользователями
- Просмотр и экспорт аудита
- Удаление любых записей

### Инженер

- Управление IP-адресами, клиентами, устройствами
- Настройка подсетей
- Нет доступа к пользователям и аудиту

### Оператор

- Просмотр информации
- Ограниченное редактирование
- Нет доступа к удалению

## Безопасность

- Хэширование паролей (bcrypt)
- Подготовленные SQL-запросы
- Валидация всех входных данных
- CSRF-токены для форм
- Защита сессий с таймаутом
- Блокировка при множественных неудачных попытках входа

## Технологии

**Backend:**

- PHP 7.4+ с ООП подходом
- MySQL 5.7+ с внешними ключами
- Сессии PHP с регенерацией ID

**Frontend:**

- HTML5, CSS3
- JavaScript (ES6+)
- Bootstrap 5.1.3
- Адаптивный дизайн

## Важные замечания

**Перед использованием в production:**

1. Замените пароли по умолчанию для тестовых пользователей
2. Настройте HTTPS для шифрования трафика
3. Регулярно создавайте бэкапы базы данных
4. Настройте безопасные заголовки на веб-сервере

## Поддержка

При проблемах с установкой:

1. Проверьте настройки БД в `includes/db_connect.php`
2. Убедитесь, что база `web_ipam` создана и импортирован `sql/init.sql`
3. Проверьте права доступа к файлам на веб-сервере
4. Проверьте логи ошибок PHP и MySQL


