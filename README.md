# Web-IPAM System

**Web-based IP Address Management System** - Веб-система для управления IP-адресным пространством оператора связи.

## О проекте

Web-IPAM (IP Address Management) — это полнофункциональное веб-приложение для автоматизации учета и управления IP-инфраструктурой. Система разработана для замены ручного ведения учета в Excel-таблицах и предотвращения конфликтов IP-адресов в сетях провайдеров и корпоративных сетях.

### Решаемые проблемы

* **Хаотичный учет IP-адресов** в Excel-таблицах
* **IP-конфликты** из-за ручного управления
* **Отсутствие централизованной информации** о сетевой инфраструктуре
* **Сложность поиска** информации об абонентах и устройствах
* **Отсутствие контроля доступа** к сетевым данным
* **Нет истории изменений** - кто и когда менял конфигурацию

## Установка и настройка

### Предварительные требования

* **Веб-сервер**: Apache 2.4+ (рекомендуется WAMP для Windows, LAMP для Linux, MAMP для Mac)
* **PHP**: 7.4 или выше с расширениями:
  - mysqli
  - session
  - json
* **База данных**: MySQL 5.7 или выше (рекомендуется MySQL 8.0+)
* **Браузер**: Современный браузер с поддержкой ES6+

### Шаг 1: Клонирование репозитория

```bash
# Клонируйте репозиторий
git clone https://github.com/feronski-bkpk/web-ipam.git

# Перейдите в директорию проекта
cd web-ipam
```

### Шаг 2: Настройка базы данных

#### Вариант A: Через phpMyAdmin (рекомендуется для начинающих)

1. **Откройте phpMyAdmin** в браузере: `http://localhost/phpmyadmin`

2. **Создайте новую базу данных**:
   
   - Нажмите "Создать базу данных" в левом меню
   - Имя базы: `web_ipam` (обязательно с нижним подчеркиванием!)
   - Кодировка: `utf8mb4_unicode_ci`
   - Нажмите "Создать"

3. **Импортируйте структуру базы**:
   
   - Выберите созданную базу `web_ipam`
   - Перейдите на вкладку "Импорт"
   - Нажмите "Выбрать файл" и выберите `sql/init.sql`
   - Нажмите "Вперед" (Execute)

#### Вариант B: Через командную строку MySQL

```sql
-- Создайте базу данных
CREATE DATABASE web_ipam CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- Используйте созданную базу
USE web_ipam;

-- Импортируйте SQL файл
SOURCE /путь/к/проекту/sql/init.sql;
```

### Шаг 3: Настройка подключения к базе данных

**ВНИМАНИЕ**: Обязательно отредактируйте файл `includes/db_connect.php` с вашими настройками!

```php
// includes/db_connect.php - ОБНОВИТЕ ЭТИ НАСТРОЙКИ!

class Database {
    private function connect() {
        // ⚠️ ЗАМЕНИТЕ ЭТИ НАСТРОЙКИ НА СВОИ!
        $servername = "localhost";    // Адрес сервера БД
        $username = "root";           // Имя пользователя MySQL
        $password = "";               // Пароль пользователя MySQL  
        $dbname = "web_ipam";         // Имя базы данных (не менять!)


        $this->conn = new mysqli($servername, $username, $password, $dbname);
        // ... остальной код
    }
}
```

### Шаг 4: Размещение проекта на веб-сервере

#### Для WAMP (Windows):

```bash
# Скопируйте файлы в корневую папку WAMP
C:\wamp64\www\web-ipam\
```

#### Для LAMP (Linux):

```bash
# Скопируйте файлы в корневую папку Apache
sudo cp -r web-ipam /var/www/html/

# Установите правильные права
sudo chown -R www-data:www-data /var/www/html/web-ipam
sudo chmod -R 755 /var/www/html/web-ipam
```

#### Для MAMP (Mac):

```bash
# Скопируйте файлы в корневую папку MAMP
/Applications/MAMP/htdocs/web-ipam/
```

### Шаг 5: Проверка установки

1. **Запустите веб-сервер** (WAMP/LAMP/MAMP)
2. **Откройте в браузере**: `http://localhost/web-ipam/`
3. **Должна открыться страница входа**

### Если возникают проблемы с установкой

#### Проблема: "Ошибка подключения к базе данных"

**Решение**: Проверьте настройки в `includes/db_connect.php`:

- Правильный ли `servername`?
- Верный ли `username` и `password`?
- Существует ли база `web_ipam`?

#### Проблема: "База данных не найдена"

**Решение**: Убедитесь что имя базы точно `web_ipam` (с нижним подчеркиванием)

#### Проблема: "Неверный логин или пароль" при входе

**Решение**: Используйте тестовые учетные данные (см. ниже)

## Тестовые пользователи

После успешной установки используйте эти учетные записи для входа:

| Роль            | Логин      | Пароль     | Доступ                                            |
| --------------- | ---------- | ---------- | ------------------------------------------------- |
| Администратор   | `admin`    | `admin123` | Полный доступ + аудит + безопасность              |
| Сетевой инженер | `engineer` | `admin123` | Создание и редактирование IP, клиентов, устройств |
| Оператор        | `operator` | `admin123` | Просмотр и базовые операции                       |

**ВАЖНО**: Смените пароли после первого входа в продакшн среде!

## Быстрый старт

### 1. Первый вход в систему

1. Откройте `http://localhost/web-ipam/`
2. Войдите с учетными данными `admin` / `admin123`
3. Изучите главный дашборд с основными метриками

### 2. Начальная настройка системы

1. **Добавьте подсети** в разделе "Подсети"
2. **Создайте клиентов** в разделе "Клиенты" 
3. **Добавьте устройства** в разделе "Устройства"
4. **Назначьте IP-адреса** в разделе "IP-адреса"

### 3. Ежедневное использование

- Используйте **глобальный поиск** в шапке для быстрого поиска
- Просматривайте **журнал аудита** для отслеживания изменений
- Используйте **фильтры** в таблицах для удобной работы

## Реализованный функционал

#### Система аутентификации и авторизации

- **Безопасный вход** с хэшированием паролей (bcrypt)
- **Ролевая модель доступа** (Администратор, Инженер, Оператор)
- **Защита от brute-force атак** с автоматической блокировкой
- **Система блокировок** IP и пользователей
- **Защита сессий** с таймаутом 1 час

#### Дашборд системы

- **Визуальная статистика** в реальном времени
- **Ключевые метрики**: клиенты, активные IP, свободные IP, подсети
- **Разделение по типам IP**: белые/серые адреса
- **Быстрый доступ** ко всем модулям системы

#### Модуль управления IP-адресами (ПОЛНЫЙ CRUD)

- **Создание, чтение, обновление, удаление** IP-адресов
- **Расширенная фильтрация** по типу, статусу, подсети
- **Умный поиск** по IP, MAC-адресу, клиенту, описанию
- **Визуальные индикаторы** статусов и типов IP
- **Валидация данных** - проверка принадлежности IP к подсети
- **Бизнес-логика** согласованности статусов и устройств

#### Модуль управления клиентами (ПОЛНЫЙ CRUD)

- **Полное управление** клиентами-абонентами
- **Поиск по ФИО, договору, адресу, телефону**
- **Статистика** по количеству устройств
- **Защита от удаления** при наличии связанных устройств

#### Модуль управления устройствами (ПОЛНЫЙ CRUD)

- **Управление сетевыми устройствами** по MAC-адресам
- **Валидация MAC-адресов** в формате XX:XX:XX:XX:XX:XX
- **Привязка к клиентам**
- **Автоматическое форматирование** MAC-адресов
- **Проверка уникальности** MAC-адресов

#### Расширенная система поиска

- **Глобальный поиск** по всей системе
- **Поиск в реальном времени** по:
  - MAC-адресам устройств
  - IP-адресам
  - ФИО клиентов
  - Номерам договоров
  - Моделям устройств
- **Интегрированный поиск** в навигационной панели

#### Расширенная система аудита и безопасности

- **Полное логирование всех действий** в системе
- **Журнал аудита** с фильтрацией и поиском
- **Отслеживание входа/выхода** пользователей
- **Мониторинг неудачных попыток входа**
- **Система блокировок** IP-адресов при подозрительной активности
- **Статистика безопасности** в реальном времени
- **Подозрительная активность** - автоматическое обнаружение атак

### В процессе разработки

- [ ] Модуль управления подсетями
- [ ] Модуль управления пользователями системы
- [ ] Система массовых операций
- [ ] Расширенная отчетность и аналитика
- [ ] API для интеграции с другими системами

## Архитектура базы данных

```
users (Пользователи системы)
├── id, login, password_hash, role, full_name, created_at
├── last_login, failed_login_attempts, account_locked_until

clients (Клиенты-абоненты)  
├── id, contract_number, full_name, address, phone
├── created_at, updated_at

subnets (Подсети)
├── id, network_address, cidr_mask, gateway, description
├── created_at, updated_at

devices (Сетевые устройства)
├── id, mac_address, model, serial_number, client_id
├── created_at, updated_at

ip_addresses (IP-адреса)
├── id, ip_address, subnet_id, device_id, type, status
├── description, created_by, created_at, updated_at

system_audit_log (Общий аудит системы)
├── id, user_id, action_type, module, record_id, description
├── ip_address, user_agent, old_values, new_values, created_at

security_blocks (Блокировки безопасности)
├── id, ip_address, block_type, attempts, first_attempt
├── last_attempt, blocked_until, reason
```

## Ролевая модель доступа

### Администратор

- **Полный доступ** ко всем функциям системы
- **Управление пользователями** системы
- **Просмотр журнала аудита** - история всех действий
- **Мониторинг безопасности** - просмотр блокировок и атак
- **Удаление любых записей**

### Сетевой инженер

- **Управление IP-адресами** - создание, редактирование
- **Управление клиентами и устройствами**
- **Привязка белых IP** к клиентам
- **Настройка оборудования** на основе данных системы
- **Просмотр всей информации** о сети и клиентах

### Оператор

- **Просмотр информации** - клиенты, устройства, IP-адреса
- **Ограниченное редактирование** IP-адресов
- **Поиск информации** для техподдержки
- **Нет доступа к удалению** записей
- **Нет доступа к журналу аудита**

## Ключевые сценарии использования

### Поиск информации об абоненте

1. Откройте раздел "IP-адреса" или используйте глобальный поиск
2. Введите ФИО клиента или MAC-адрес
3. Найдите все связанные IP и устройства за секунды

### Добавление нового IP-адреса

1. Нажмите "Добавить IP-адрес"
2. Заполните форму с валидацией
3. Система проверит принадлежность к подсети
4. **Автоматически создаст запись в аудите**

### Работа техподдержки

1. Принимайте звонок от абонента
2. Используйте поиск по ФИО или адресу
3. Мгновенно получайте всю информацию:
   - IP-адрес и тип
   - Модель роутера и MAC-адрес
   - Историю подключений

### Реагирование на инциденты безопасности

1. Обнаружьте проблемный IP-адрес
2. Найдите его в системе через поиск
3. Получите полную информацию о клиенте
4. Примите меры за минуты вместо часов

## Технологический стек

### Backend

- **PHP 7.4+** - серверный язык с ООП подходом
- **MySQL 5.7+** - реляционная база данных
- **Apache** - веб-сервер
- **Сессии PHP** - управление аутентификацией

### Frontend

- **HTML5** - семантическая разметка
- **CSS3** - современные стили с Flexbox/Grid
- **JavaScript (ES6+)** - клиентская логика
- **Bootstrap 5** - адаптивный UI-фреймворк
- **Responsive Design** - мобильная адаптация

### Безопасность

- **Password hashing** - `password_hash()`/`password_verify()`
- **Prepared statements** - защита от SQL-инъекций
- **Input validation** - валидация всех входных данных
- **Session security** - регенерация ID, таймауты
- **XSS protection** - `htmlspecialchars()` на выводе
- **Ролевой доступ** - разделение прав по ролям
- **Brute-force protection** - автоматическая блокировка атак
- **IP blocking** - защита от подозрительной активности

## Структура проекта

```
web-ipam/
├── index.php                 # Главная страница (Дашборд)
├── login.php                 # Страница авторизации
├── logout.php                # Выход из системы
├── README.md                 # Документация (этот файл)
├── .gitignore                # Git исключения
│
├── includes/                 # PHP модули системы
│   ├── auth.php              # Аутентификация и авторизация
│   ├── db_connect.php        # НАСТРОЙТЕ ЭТОТ ФАЙЛ!
│   ├── audit_system.php      # Расширенная система аудита и безопасности
│   ├── header.php            # Навигация и шапка сайта
│   └── footer.php            # Подвал сайта
│
├── pages/                    # Функциональные модули
│   ├── ip-addresses/         
│   │   ├── list.php          # Список IP-адресов с фильтрами
│   │   ├── add.php           # Добавление IP-адреса
│   │   ├── edit.php          # Редактирование IP-адреса
│   │   └── delete.php        # Удаление IP-адреса
│   │
│   ├── clients/              
│   │   ├── list.php          # Список клиентов
│   │   ├── add.php           # Добавление клиента
│   │   ├── edit.php          # Редактирование клиента
│   │   └── delete.php        # Удаление клиента
│   │
│   ├── devices/              
│   │   ├── list.php          # Список устройств
│   │   ├── add.php           # Добавление устройства
│   │   ├── edit.php          # Редактирование устройства
│   │   └── delete.php        # Удаление устройства
│   │
│   ├── search/               
│   │   └── global.php        # Глобальный поиск по системе
│   │
│   ├── audit/                
│   │   └── list.php          # Журнал аудита системы
│   │
│   ├── subnets/              # В РАЗРАБОТКЕ
│   │   ├── list.php          # Список подсетей
│   │   └── edit.php          # Редактирование подсети
│   │
│   └── users/                # В РАЗРАБОТКЕ
│       ├── list.php          # Список пользователей
│       └── edit.php          # Редактирование пользователя
│
├── assets/                   # Статические ресурсы
│   ├── css/
│   │   └── style.css         # Основные стили
│   ├── js/
│   │   ├── main.js           # Основные скрипты
│   │   └── ip-form.js        # Валидация форм IP-адресов
│   └── img/                  # Изображения и иконки
│
└── sql/                      # База данных
    └── init.sql              # Инициализация БД (версия 5.0)
```

## Разработка и вклад

Мы приветствуем contributions! Чтобы внести свой вклад:

1. Форкните репозиторий
2. Создайте feature branch (`git checkout -b feature/AmazingFeature`)
3. Закоммитьте изменения (`git commit -m 'Add some AmazingFeature'`)
4. Запушьте branch (`git push origin feature/AmazingFeature`)
5. Откройте Pull Request

## Поддержка

Если у вас возникли проблемы с установкой или использованием системы:

1. **Проверьте настройки БД** в `includes/db_connect.php`
2. **Убедитесь что база данных** `web_ipam` создана и импортирован `init.sql`
3. **Проверьте права доступа** к файлам на веб-сервере
4. **Посмотрите логи ошибок** PHP и MySQL
